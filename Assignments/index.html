<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>HW0-Breakout</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <script src="breakout.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity:false,
            },
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        },

        audio: {
        disableWebAudio: true
        }
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.image('background', 'assets/sky.png');
        this.load.image('ball', 'assets/ball1.png');
        this.load.image('paddle', 'assets/paddle1.png');
        this.load.image('greenBrick', 'assets/green1.png');
        this.load.image('blueBrick', 'assets/blue1.png');
        this.load.image('redBrick', 'assets/red1.png');

        this.load.audio('theme', [
        'assets/Mii.ogg',
        'assets/Mii.mp3'
        ]);
    }

    function create ()
    {
        this.add.image(400, 300, 'background');

        //Enable world bounds, disable the floor
        this.physics.world.setBoundsCollision(true, true, true, false);
   
        ball = this.physics.add.sprite(400,545,'ball');
        player = this.physics.add.sprite(400, 570, 'paddle');

        greenBricks = this.physics.add.group({
            key: 'greenBrick',
            repeat: 9,
            immovable: true, //To make ball keep moving
            setXY: {
                x: 80,
                y: 190,
                stepX: 70
            }
        });

        blueBricks = this.physics.add.group({
            key: 'blueBrick',
            repeat: 9,
            immovable: true,
            setXY: {
                x: 80,
                y: 140,
                stepX: 70
            }
        });

        redBricks = this.physics.add.group({
            key: 'redBrick',
            repeat: 9,
            immovable: true,
            setXY: {
                x: 80,
                y: 90,
                stepX: 70
            }
        });

        openingText = this.add.text(
        this.physics.world.bounds.width / 2,
        this.physics.world.bounds.height / 2,
        'Press SPACE to Start',
        {
            fontFamily: 'Monaco, Courier, monospace',
            fontSize: '50px',
            fill: '#fff'
        }
        );
        openingText.setOrigin(0.5);

        // Create game over text
        gameOverText = this.add.text(
        this.physics.world.bounds.width / 2,
        this.physics.world.bounds.height / 2,
        'Game Over',
        {
            fontFamily: 'Monaco, Courier, monospace',
            fontSize: '50px',
            fill: 'black'
        }
        );
        gameOverText.setOrigin(0.5);
        // Make it invisible until the player loses
        gameOverText.setVisible(false);

        // Create the game won text
        playerWonText = this.add.text(
        this.physics.world.bounds.width / 2,
        this.physics.world.bounds.height / 2,
        'You won!',
        {
            fontFamily: 'Monaco, Courier, monospace',
            fontSize: '50px',
            fill: '#fff'
        }
        );
        playerWonText.setOrigin(0.5);
        // Make it invisible until the player wins
        playerWonText.setVisible(false);

        cursors = this.input.keyboard.createCursorKeys();
        player.setCollideWorldBounds(true);
        ball.setCollideWorldBounds(true);

        ball.setBounce(1, 1);

        this.physics.add.collider(ball, greenBricks, hitBrick, null, this);
        this.physics.add.collider(ball, redBricks, hitBrick, null, this);
        this.physics.add.collider(ball, blueBricks, hitBrick, null, this);
        player.setImmovable(true);
        this.physics.add.collider(ball, player, hitPlayer, null, this);

        var music = this.sound.add('theme');
        music.setLoop(true);
        music.play();
    }

    function update ()
    {
        // Check if the ball left the scene i.e. game over
        frameCounter++;
        if (isGameOver(this.physics.world)) {
            gameOverText.setVisible(true);
            ball.disableBody(true, true);
        }
        else if (isWon()) {
            playerWonText.setVisible(true);
            ball.disableBody(true, true);
        }
        else {
            // Put this in so that the player stays still if no key is being pressed
            player.body.setVelocityX(0);
            let chance = Math.random();
            let newSize = Math.random();
            if( (chance < 0.5) && (frameCounter % 25 == 0))
                player.setDisplaySize((newSize * 250), 24);

            //Be right above cursor
            if (!gameStarted) {
                ball.setX(player.x);
            }

            if (cursors.space.isDown) {
                gameStarted = true;
                ball.setVelocityY(-200);
                openingText.setVisible(false);
            }

            if (cursors.left.isDown) {
                player.body.setVelocityX(-500);
            } else if (cursors.right.isDown) {
                player.body.setVelocityX(500);
            }
        }
    }

</script>

</body>
</html>
